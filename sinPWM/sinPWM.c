#include <Arduino.h>
#include <avr/interrupt.h>
#include <math.h>

#define pi 3.1415926535897932384626433832795
#define TOP0 256
#define TOP1 256
#define TOP2 256
#define M 0.7
#define F 50.0

volatile double t = 0.0;
volatile byte TEST = 0;

int data1[201] = {128, 131, 134, 136, 139, 142, 145, 148, 150, 153, 156, 158, 161, 164, 166, 169, 171, 174, 176, 178, 181, 183, 185, 187, 189, 191, 193, 195, 197, 199, 200, 202, 204, 205, 207, 208, 209, 210, 211, 212, 213, 214, 215, 215, 216, 216, 217, 217, 217, 218, 218, 218, 217, 217, 217, 216, 216, 215, 215, 214, 213, 212, 211, 210, 209, 208, 207, 205, 204, 202, 200, 199, 197, 195, 193, 191, 189, 187, 185, 183, 181, 178, 176, 174, 171, 169, 166, 164, 161, 158, 156, 153, 150, 148, 145, 142, 139, 136, 134, 131, 128, 125, 122, 120, 117, 114, 111, 108, 106, 103, 100, 98, 95, 92, 90, 87, 85, 82, 80, 78, 75, 73, 71, 69, 67, 65, 63, 61, 59, 57, 56, 54, 52, 51, 49, 48, 47, 46, 45, 44, 43, 42, 41, 41, 40, 40, 39, 39, 39, 38, 38, 38, 39, 39, 39, 40, 40, 41, 41, 42, 43, 44, 45, 46, 47, 48, 49, 51, 52, 54, 56, 57, 59, 61, 63, 65, 67, 69, 71, 73, 75, 78, 80, 82, 85, 87, 90, 92, 95, 98, 100, 103, 106, 108, 111, 114, 117, 120, 122, 125};
int data2[201] = {206, 204, 203, 201, 199, 198, 196, 194, 192, 190, 188, 186, 184, 181, 179, 177, 174, 172, 170, 167, 164, 162, 159, 157, 154, 151, 148, 146, 143, 140, 137, 135, 132, 129, 126, 123, 121, 118, 115, 112, 109, 107, 104, 101, 99, 96, 93, 91, 88, 86, 83, 81, 78, 76, 74, 72, 69, 67, 65, 63, 61, 60, 58, 56, 54, 53, 51, 50, 49, 47, 46, 45, 44, 43, 42, 41, 41, 40, 40, 39, 39, 39, 38, 38, 38, 39, 39, 39, 39, 40, 40, 41, 42, 42, 43, 44, 45, 47, 48, 49, 50, 52, 53, 55, 57, 58, 60, 62, 64, 66, 68, 70, 72, 75, 77, 79, 82, 84, 86, 89, 92, 94, 97, 99, 102, 105, 108, 110, 113, 116, 119, 121, 124, 127, 130, 133, 135, 138, 141, 144, 147, 149, 152, 155, 157, 160, 163, 165, 168, 170, 173, 175, 178, 180, 182, 184, 187, 189, 191, 193, 195, 196, 198, 200, 202, 203, 205, 206, 207, 209, 210, 211, 212, 213, 214, 215, 215, 216, 216, 217, 217, 217, 218, 218, 218, 217, 217, 217, 217, 216, 216, 215, 214, 214, 213, 212, 211, 209, 208, 207};
int data3[201] = {50, 49, 48, 47, 45, 44, 43, 43, 42, 41, 40, 40, 39, 39, 39, 39, 38, 38, 38, 39, 39, 39, 40, 40, 41, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 53, 54, 56, 58, 60, 61, 63, 65, 67, 69, 72, 74, 76, 78, 81, 83, 86, 88, 91, 93, 96, 99, 101, 104, 107, 109, 112, 115, 118, 121, 123, 126, 129, 132, 135, 137, 140, 143, 146, 148, 151, 154, 157, 159, 162, 164, 167, 170, 172, 174, 177, 179,1181, 184, 186, 188, 190, 192, 194, 196, 198, 199, 201, 203, 204, 206, 207, 208, 209, 211, 212, 213, 213, 214, 215, 216, 216, 217, 217, 217, 217, 218, 218, 218, 217, 217, 217, 216, 216, 215, 215, 214, 213, 212, 211, 210, 209, 207, 206, 205, 203, 202, 200, 198, 196, 195, 193, 191, 189, 187, 184, 182, 180, 178, 175, 173, 170, 168, 165, 163, 160, 157, 155, 152, 149, 147, 144, 141, 138, 135, 133, 130, 127, 124, 121, 119, 116, 113, 110, 108, 105, 102, 99, 97, 94, 92, 89, 86, 84, 82, 79, 77, 75, 72, 70, 68, 66, 64, 62, 60, 58, 57, 55, 53, 52};

volatile int i = 0;

ISR (TIMER1_OVF_vect){        //TIMER1_OVF_vect 
    TCNT0 = 0;
    TCNT2 = 0;



    OCR0A = data1[i];           // PWM Pin 6
    OCR0B = data2[i];           // PWM Pin 5
    OCR2A = data3[i];           // PWM Pin 11

    i++;
    if (i >= 200)  i = 0;
}

void setup() {
    cli();//stop interrupts

    // PWM by timer 0 ---------------------------------------------------
    TCNT0 = 0;
    TCCR0A = 0; TCCR0B = 0; // Reset 2 registers
    DDRD |= (1 << PD5);     // PD5 is OUTPUT (pin 5)
    DDRD |= (1 << PD6);     // PB1 is OUTPUT (pin 6 )   
    
    TCCR0A |= (1 << WGM01) | (1 << WGM00);
    TCCR0A |= (1 << COM0B1);  // Fast mode Pin 5
    TCCR0A |= (1 << COM0A1);  // Fast mode Pin 6
    TCCR0A |= (1 << COM0A1);  // None-inverted mode Pin 6
    TCCR0A |= (1 << COM0B1);  // None-inverted mode Pin 5
    // TCCR0A |= (1 << COM0B1) | (1 << COM0B0);  // inverted mode Pin 5

    TCCR0B |= (1 << CS10);   // No Prescaling = F_Clock or F_clock/1=16mhz
    // TCCR0B = TCCR0B & B11111000 | B00000001; // for PWM frequency ofÂ 62500.00 Hz
    
    
    // PWM by timer 2 and Interrupt ---------------------------------------------------
    TCNT2 = 0;
    TCCR2A = 0; TCCR2B = 0;
    DDRD |= (1 << PD3);   // output Pin 3
    DDRB |= (1 << PB3);   // output Pin 11
    TCCR2A |= (1 << COM2A1);    // None-inverted Pin 11
    TCCR2A |= (1 << COM2B1) | (1 << COM2B0);    // inverted Pin 3
    TCCR2A |= (1 << WGM21) | (1 << WGM20);      // Xung rang cua
    TCCR2B |= (0 << CS22) | (0 << CS21) | (1 << CS20);  // Prescaler 

    // PWM by timer 1 -------------------------------------------------
    TCNT1 = 0;
    TCCR1A = 0; TCCR1B = 0; // Reset 2 registers
    DDRB |= (1 << PB2);     // PB2 is OUTPUT (pin 10)
    DDRB |= (1 << PB1);     // PB1 is OUTPUT (pin 9 )   
    
    TCCR1A |= (1 << WGM11);
    TCCR1B |= (1 << WGM12)|(1 << WGM13); // select Fast PWM mode select TOP_value freely ICR1                     
    TCCR1A |= (1 << COM1B1); // None-inverted mode
    TCCR1A |= (1 << COM1A1);    // None-inverted mode Pin 9
    // TCCR1A |= (1 << COM1B1) | (1 << COM1B0);  // inverted mode Pin 10
    
    ICR1 = 1599;                // Frequency = 16M / TOP
    TCCR1B |= (1 << CS10);              // No Prescaling = F_Clock or F_clock/1=16mhz
    
    TIMSK1 |= (1 << TOIE1);         // Timer1 Overflow Interrupt Enable
    sei();
}

void loop() {

}
